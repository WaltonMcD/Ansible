--- # Bootstrap Webservers
- name: Bootstrap Webservers
  hosts: webservers
  become: true
  gather_facts: true

  tasks:
  - name: Latest httpd server
    ansible.builtin.yum:
      name: httpd
      state: 2.4.54

  - name: Create index.html file
    ansible.builtin.file:
      name: /var/www/html/index.html
      state: touch
      mode: u+rw,g-wx,o-rwx

  - name: Web content
    ansible.builtin.lineinfile:
      line: "Hello World From {{ ansible_hostname }}"
      path: /var/www/html/index.html
    notify:
      - restart httpd

  - name: Start apache httpd
    ansible.builtin.service:
      name: httpd
      state: started
    register: task_start_httpd

  - name: Print httpd status
    ansible.builtin.debug:
      msg: "Output of starting httpd: {{ task_start_httpd }}"

  - name: Enable apache httpd
    ansible.builtin.service:
      name: httpd
      state: enabled

  # If contents of index.html are changed we will restart httpd
  handlers:
    - name: Restart httpd
      ansible.builtin.service:
        name: httpd
        state: restarted
      listen: "restart httpd"
